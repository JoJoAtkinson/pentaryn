[pipeline]
name = "dnd_audio_pipeline"
version = "1.0.0"
default_output_dir = ".output"
audio_mode = "auto"  # auto | discord_multitrack | table_single_mic
session_id = ""

[azure]
subscription_id = "7593eb4d-6c88-49cb-a4c8-fbe209e62151"
resource_group = "AtJoseph-rg"
workspace_name = "joe-ml-sandbox"
compute_target_gpu = "gpu-transcribe"  # GPU compute for Steps 1-4
compute_target_cpu = "cpu-preprocess"  # CPU compute for Step 0 (FFmpeg)
environment_name = "whisperx-gpu"
hf_auth_token = ""  # Loaded from .env or environment variable

[preprocess]
enabled = true
sample_rate = 16000
channels = 1
loudnorm_target_lufs = -23.0
loudnorm_range_lu = 11.0
true_peak_db = -1.5
highpass_hz = 80
two_pass = true
output_format = "flac"
parallel_tracks = 0  # Chunk workers per track (0 = auto CPU count)
progress_interval_seconds = 15

[transcription]
model = "large-v3"
language = "en"
compute_type = "float16"
batch_size = 16
chunk_duration_hours = 3.0
overlap_seconds = 120.0
vad_filter = true
owned_interval_stitching = true

[diarization]
model = "pyannote/speaker-diarization-3.1"
min_speakers = 2
max_speakers = 6
overlap_threshold = 0.5
device = "cpu"  # "cpu" | "cuda"
cross_chunk_linkage = "average"
cross_chunk_threshold = 0.78
overlap_window_seconds = 120.0

[emotion]
model = "tiantiaf/wavlm-large-msp-podcast-emotion-dim"
label_set = "arousal_valence_dominance"
batch_size = 32
min_segment_duration = 0.5
derived_labels = true
text_fallback = false
confidence_strategy = "none"  # "none" | "calibrated"

[speaker_embedding]
model = "speechbrain/spkrec-ecapa-voxceleb"
min_turn_duration_seconds = 1.5
top_k_segments = 20
max_embeddings_per_speaker = 50
aggregation = "mean"
database_path = "speaker_db/embeddings.json"
delta_output_path = "4_speaker_embedding/speaker_db_delta.json"

[speaker_matching]
assignment = "hungarian"
similarity_threshold = 0.85
centroid_update_threshold = 0.88
stability_percentile = 0.10
stability_threshold = 0.80
min_clean_duration_seconds = 60.0

[naming]
canonical_name_case = "lower"
replace_spaces_with = "-"
replace_underscores_with = "-"
strip_non_alnum = true

[postprocess]
validation_strict = false
unknown_speaker_handling = "preserve"  # "preserve" | "merge" | "flag"

[logging]
level = "INFO"
format = "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
